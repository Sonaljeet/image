Sub DownloadFilesUsingXMLHTTP()
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets(1)

    Dim lastRow As Long
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row

    Dim lastCol As Long
    lastCol = ws.Cells(1, ws.Columns.Count).End(xlToLeft).Column

    Dim downloadPath As String
    downloadPath = Environ("USERPROFILE") & "\Downloads\"

    Dim i As Long
    Dim docWebURL As String, sharepointURL As String
    Dim docWebFile As String, sharepointFile As String

    For i = 2 To lastRow
        docWebURL = Trim(ws.Cells(i, lastCol - 1).Value)
        sharepointURL = Trim(ws.Cells(i, lastCol).Value)

        ' Download DocWeb (no extension-based)
        If docWebURL <> "" Then
            docWebFile = downloadPath & "DocWeb" & Format(i - 1, "00")
            Call DownloadAndSave(docWebURL, docWebFile, True)
        End If

        ' Download SharePoint (extension-based)
        If sharepointURL <> "" Then
            Dim ext As String
            ext = Mid(sharepointURL, InStrRev(sharepointURL, "."))
            sharepointFile = downloadPath & "Sharepoint" & Format(i - 1, "00") & ext
            Call DownloadAndSave(sharepointURL, sharepointFile, False)
        End If
    Next i

    MsgBox "All files downloaded successfully!"
End Sub

Sub DownloadAndSave(ByVal fileURL As String, ByVal savePath As String, ByVal detectExtension As Boolean)
    Dim http As Object, stream As Object
    Dim contentType As String, fileExt As String

    Set http = CreateObject("MSXML2.XMLHTTP")
    http.Open "GET", fileURL, False
    http.Send

    If http.Status = 200 Then
        If detectExtension Then
            contentType = LCase(http.getResponseHeader("Content-Type"))
            Select Case contentType
                Case "application/pdf": fileExt = ".pdf"
                Case "application/vnd.openxmlformats-officedocument.wordprocessingml.document": fileExt = ".docx"
                Case "application/msword": fileExt = ".doc"
                Case Else: fileExt = ".bin"
            End Select
            savePath = savePath & fileExt
        End If

        Set stream = CreateObject("ADODB.Stream")
        stream.Type = 1 'binary
        stream.Open
        stream.Write http.responseBody
        stream.SaveToFile savePath, 2 'overwrite
        stream.Close
    Else
        MsgBox "Failed to download: " & fileURL & vbCrLf & "Status: " & http.Status
    End If
End Sub
