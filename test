Sub DownloadPDFsToFolders()
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets(1) ' Adjust if your data is on another sheet

    Dim lastRow As Long, lastCol As Long
    Dim url1 As String, url2 As String
    Dim rowFolderPath As String
    Dim baseFolder As String
    Dim i As Long

    ' Set base download folder (relative to workbook path)
    baseFolder = ThisWorkbook.Path & "\PDF_Downloads"

    ' Create base folder if it doesn't exist
    If Dir(baseFolder, vbDirectory) = "" Then
        MkDir baseFolder
    End If

    ' Determine last row and column with data
    lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row
    lastCol = ws.Cells(1, ws.Columns.Count).End(xlToLeft).Column

    ' Loop through each row starting from row 2
    For i = 2 To lastRow
        url1 = Trim(ws.Cells(i, lastCol - 1).Value)
        url2 = Trim(ws.Cells(i, lastCol).Value)

        ' Create a folder for each row
        rowFolderPath = baseFolder & "\Row_" & i
        If Dir(rowFolderPath, vbDirectory) = "" Then
            MkDir rowFolderPath
        End If

        ' Download files if URLs are provided
        If url1 <> "" Then
            DownloadFile url1, rowFolderPath & "\file1.pdf"
        End If
        If url2 <> "" Then
            DownloadFile url2, rowFolderPath & "\file2.pdf"
        End If
    Next i

    MsgBox "Download completed for all rows!"
End Sub

Sub DownloadFile(ByVal fileURL As String, ByVal savePath As String)
    Dim WinHttpReq As Object
    Set WinHttpReq = CreateObject("WinHttp.WinHttpRequest.5.1")

    On Error GoTo ErrorHandler

    WinHttpReq.Option(6) = True ' Enable auto-redirect
    WinHttpReq.Open "GET", fileURL, False
    WinHttpReq.Send

    If WinHttpReq.Status = 200 Then
        Dim oStream As Object
        Set oStream = CreateObject("ADODB.Stream")
        oStream.Type = 1 ' Binary
        oStream.Open
        oStream.Write WinHttpReq.ResponseBody
        oStream.SaveToFile savePath, 2 ' 2 = Overwrite
        oStream.Close
    Else
        Debug.Print "HTTP Status: " & WinHttpReq.Status & " for " & fileURL
    End If

    Exit Sub

ErrorHandler:
    Debug.Print "Error downloading: " & fileURL
End Sub
